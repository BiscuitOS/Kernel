Interrupt 7 -- Device Not Available Exception (#NM)
----------------------------------------------------

### Description

  Indicates one of the following things:

  The device-not-available exception is generated by either of thress
  conditions:

  * The processor executed an X87 FPU floating-point instruction while
    the EM flag in control register CR0 was set.

  * The processor executed a WAIT/FWAIT instruction while the MP and TS
    flags os register CR0 were set, regardless of the setting of the 
    EM flag.

### Exception Error Code

  None

### Saved Instruction Pointer

  The saved contents of CS and EIP registers point to the floating-point
  instruction or the WAIT/FWAIT instruction that generated the exception.

### Program State Change

  A program-state change does not accompany the device-not-avaiable fault,
  because the instruction that generated the exception is not executed.

  If the EM flag is set, the exception handler can then read the floating-
  point instruction pointed to by the EIP and call the appropriate emulation
  routine.

  If the MP and TS flags are set or the TS flag alone is set, the exception
  handler can save the contents of the X87 FPU, clear the TS flag, and
  continue execution at the interrupted floating-point or WAIT/FWAIT
  instruction.

### File list

  * interrupt7.c

    Common entry for triggering interrupt 7 (#NM) to be invoked by top
    interface.
 
  * soft-interrupt.c

    Describe how to trigger interrupt 7 (#NM) through soft-interrupt routine.

  * README.md

    Describe the basic information for interrupt 7 (#NM).

### Usage on BiscuitOS

  The kernel of BiscuitOS supports debug Interrupt7 online. Developer utilize
  `qemu` and `Kbuild` to debug #NM that contains specific triggered condition.
  please follow these action:

  1. Specify triggered condition with `Kbuild`.

     On top of kernel source tree, utilize `make menuconfig` to configure
     specific triggered condition for #NM. as follow:

     ```
       cd */BiscuitOS/kernel
       make menuconfig
     ```

     Then, developer will obtain figure as follow, please choose `Kernel 
     hacking`.

     ![Alt text](https://github.com/EmulateSpace/PictureSet/blob/master/BiscuitOS/BiscuitOS_common_Kbuild.png)

     The next figure, set `Debug/Running kernel` as `Y` and select `TestCase
     configuration`

     ![Alt text](https://github.com/EmulateSpace/PictureSet/blob/master/BiscuitOS/kernel_hacking/kernel_hacking.png)

     Now, set `Testcase for kernel function` as `Y` and select `Interrupt 
     Machanism on X86 Arichitecture`

     ![Alt text](https://github.com/EmulateSpace/PictureSet/blob/master/BiscuitOS/kernel_hacking/testcase/TestCase.png)

     Then, set `Debug Interrupt Machanism on X86 Architecture` and go on
     selecting `Interrupt 7 - Device Not Available Exception (#NM)`.

     ![Alt text](https://github.com/EmulateSpace/PictureSet/blob/master/BiscuitOS/kernel_hacking/testcase/interrupt/INT_INT5_TOP.png)

     Finally, set `Interrupt 7 - Device Not Available Exception (#NM)` as `Y`
     and choose a specific triggered condition to trigger #NM.

     ![Alt text](https://github.com/EmulateSpace/PictureSet/blob/master/BiscuitOS/kernel_hacking/testcase/interrupt/INT_INT5_MENU.png)

  2. Running and Debugging #NM

     The system default enable running BiscuitOS on `qemu`, so develper can
     running and debugging #BR as follow:

     ```
       cd */BiscuitOS/kernel
       make
       make start
     ```

     The Running-Figure as follow:

     ![Alt text](https://github.com/EmulateSpace/PictureSet/blob/master/BiscuitOS/kernel_hacking/testcase/interrupt/INT_INT5_RUN.png)

  3. Demo Code

     Developer can refer and review demo code on kernel procedure to debug or 
     prevent #NM. The demo code will indicate the triggered condition for #BR
     on kernel, so developer should review demo code details and prevent 
     #NM on your procedure. For example:

     ```
       /*
        * trigger interrupt 7: invoke 'int $0x7'
        *   Note! whatever interrupt is enable or disable, this routine
        *   will trigger interrupt 7.
        */
       void trigger_interrupt7(void)
       {
           printk("Trigger interrupt 7: invoke 'int $0x7'\n");
           __asm__ ("int $7");
       }
     ```
